### 1. 产品目标

为「在 Binance 期货上有 USDT 永续合约的标的」构建一个 **自用看盘监控 bot**：

- 持续监控：价格、CVD、OI、资金费率
- 在出现明显资金流向或极端资金费率时，通过 Telegram 告警
- 0 成本数据源（只用 Binance 官方接口），后续再插 Coinglass 等模块

---

### 2. 监控标的范围

- 必须满足：
    - 在 **Binance USDT‑M 永续** 上有交易对（如 `BTCUSDT`, `ETHUSDT`）
- MVP：
    - 默认监控 1–2 个 symbol（例如：`BTCUSDT`，可在配置中扩展）

---

### 3. 指标定义与计算

**统一时间窗口：5 分钟滚动窗口**

1. **价格（Price）**
    - 来源：Binance Futures `aggTrade` 流（或 ticker）
    - 用途：作为告警时的背景信息
2. **CVD（Cumulative Volume Delta）**
    - 窗口：最近 5 分钟
    - 定义：
        - 对窗口内每笔成交，按主动买入 / 主动卖出区分
        - 折算为 U 值：`成交量 × 成交价`
        - CVD_5m = Σ(主动买入额) − Σ(主动卖出额)
    - 结果单位：**美元等价值（U）**
3. **未平仓合约量 OI（Open Interest）**
    - 来源：`/fapi/v1/openInterest`
    - 记录：
        - 当前总 OI（折算为 U，或使用 Binance 返回的张数乘以标的面值）
        - 5 分钟前的 OI 值
    - 计算：
        - OI_now：当前 OI
        - OI_past：5 分钟前 OI
        - ΔOI_abs = |OI_now − OI_past|
        - ΔOI_pct = ΔOI_abs / OI_now
4. **资金费率 Funding Rate**
    - 来源：`/fapi/v1/premiumIndex`
    - 使用字段：
        - `lastFundingRate`（当前资金费率）
        - `nextFundingTime`（可选，用于提示下次结算时间）

---

### 4. 触发告警条件（核心部分）

### 4.1 组合告警：多头 / 空头流入

**前提：窗口 = 5 分钟**

1. **多头流入告警**

在同一 5 分钟窗口内，同时满足：

- CVD_5m ≥ +5,000,000 U（净主动买入等价 ≥ 500 万 U）
- 且 OI 满足下面的「动态阈值」之一：
    - 若当前总 OI < 30,000,000 U：
        - ΔOI_abs ≥ 1,000,000 U
    - 若当前总 OI ≥ 30,000,000 U：
        - ΔOI_pct ≥ 5%

→ 触发 **「多头流入告警」**。

1. **空头流入告警**

在同一 5 分钟窗口内，同时满足：

- CVD_5m ≤ −5,000,000 U（净主动卖出等价 ≥ 500 万 U）
- 且 OI 满足「动态阈值」之一：
    - 若当前总 OI < 30,000,000 U：
        - ΔOI_abs ≥ 1,000,000 U
    - 若当前总 OI ≥ 30,000,000 U：
        - ΔOI_pct ≥ 5%

→ 触发 **「空头流入告警」**。

> 心智模型：
> 

> - CVD 提供「方向 + 主动性」
> 

> - OI 提供「仓位规模是否同步放大」
> 

> - OI 分大小盘两档：小盘用绝对变动， 大盘用百分比
> 

---

### 4.2 单项极值告警：资金费率

当任一时刻满足：

- `funding > 0.1%`（即 `> 0.001`）
    
    或
    
- `funding < -0.1%`（即 `< -0.001`）

→ 立即触发 **资金费率告警**，不依赖 CVD/OI 条件。

对应你文案里的：

> 若 funding ＞0.1%或funding＜-0.1%，触发告警
> 

---

### 5. 冷却 / 限频策略

- 冷却时间：**15 分钟**
- 维度：
    - 按「symbol + 告警类型」分别计时：
        - 例如：`BTCUSDT + 多头流入`，`BTCUSDT + funding 极值` 各自有冷却时间
- 规则：
    - 同一个 symbol、同一种告警类型：
        - 首次满足条件时立刻触发
        - 之后 15 分钟内，即使条件再次满足，也不重复推送同类型告警

---

### 6. 输出与通知方式（MVP）

1. **通知渠道**
- Telegram 机器人发送到：
    - 你的个人聊天 / 私有频道 / 私有群（在配置中指定 `chat_id`）
1. **告警内容（示例模版）**
- 多头流入告警示例：

> `[BTCUSDT] 多头流入告警`
> 

> 窗口：5m
> 

> 价格：xxxxx.xx
> 

> CVD：+8.2M U
> 

> OI：当前 32M U，5m 变化 +6%（+1.9M U）
> 

> Funding：0.12%
> 

> 时间：2025-11-27 11:30 (UTC+8)
> 
- 空头流入 / funding 极值 告警的格式类似，只改文案和数值。

---

### 7. 配置项（可以放在 config.yaml）

必需配置：

- `symbols`: 监控交易对列表
- `window_minutes`: 5
- `cvd.usd_threshold`: 5_000_000
- `oi.small_oi_threshold_usd`: 30_000_000
- `oi.small_oi_min_change_usd`: 1_000_000
- `oi.large_oi_min_change_pct`: 5
- `funding.threshold`: 0.001
- `alerts.cooldown_minutes`: 15